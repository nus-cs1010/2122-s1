
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://nus-cs1010.github.io/2122-s1/17-heap.html">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.3">
    
    
      
        <title>17. Heap - CS1010 Programming Methodology</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.3b61ea93.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-17-heap" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://nus-cs1010.github.io/2122-s1" title="CS1010 Programming Methodology" class="md-header-nav__button md-logo" aria-label="CS1010 Programming Methodology">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            CS1010 Programming Methodology
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              17. Heap
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://nus-cs1010.github.io/2122-s1" title="CS1010 Programming Methodology" class="md-nav__button md-logo" aria-label="CS1010 Programming Methodology">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    CS1010 Programming Methodology
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="index.html" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="midterm.html" class="md-nav__link">
      Midterm
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="pe1.html" class="md-nav__link">
      PE1
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    
    <label class="md-nav__link" for="nav-4">
      General
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="General" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="about.html" class="md-nav__link">
      About CS1010
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="outcomes.html" class="md-nav__link">
      Learning Outcomes
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="schedule.html" class="md-nav__link">
      Schedule
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="accounts.html" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="policies.html" class="md-nav__link">
      Policies
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="tutors.html" class="md-nav__link">
      Teaching Team
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Notes
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Notes" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="01-program.html" class="md-nav__link">
      1. What is a Program?
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="02-algo.html" class="md-nav__link">
      2. Computational Problem & Algorithms
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="03-func.html" class="md-nav__link">
      3. Functions
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="04-type.html" class="md-nav__link">
      4. Types
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="05-first-c.html" class="md-nav__link">
      5. First C Program
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="06-cs1010-io.html" class="md-nav__link">
      6. CS1010 I/O
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="07-arithmetic-ops.html" class="md-nav__link">
      7. Arithmetic Operations
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="08-if-else.html" class="md-nav__link">
      8. Conditional Statement
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="09-logical-exp.html" class="md-nav__link">
      9. Logical Expression
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="10-assert.html" class="md-nav__link">
      10. Assertions
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="11-loop.html" class="md-nav__link">
      11. Loops
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="12-invariant.html" class="md-nav__link">
      12. Invariant
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="13-call-stack.html" class="md-nav__link">
      13. Stack
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="14-array.html" class="md-nav__link">
      14. Array
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="15-pointers.html" class="md-nav__link">
      15. Pointer
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="16-call-by-reference.html" class="md-nav__link">
      16. Call-by-Reference
    </a>
  </li>

        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        17. Heap
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="17-heap.html" class="md-nav__link md-nav__link--active">
      17. Heap
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-on-heap" class="md-nav__link">
    Variables on Heap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-memory-allocation-deallocation" class="md-nav__link">
    Manual Memory Allocation / Deallocation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-deallocation" class="md-nav__link">
    Memory Deallocation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-reallocation" class="md-nav__link">
    Memory Reallocation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cs1010-io-library" class="md-nav__link">
    CS1010 I/O Library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-set" class="md-nav__link">
    Problem Set
  </a>
  
    <nav class="md-nav" aria-label="Problem Set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-set-171" class="md-nav__link">
    Problem Set 17.1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="18-string.html" class="md-nav__link">
      18. String
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="19-md-array.html" class="md-nav__link">
      19. ND Array
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="20-macro.html" class="md-nav__link">
      20. C preprocessor
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="21-efficiency.html" class="md-nav__link">
      21. Efficiency
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    
    <label class="md-nav__link" for="nav-6">
      Exercises
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Exercises" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Exercises
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="ex00.html" class="md-nav__link">
      0. Echo, Divide, Ones, BMI, Quadratic
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex01.html" class="md-nav__link">
      1. Odd, Sum, Triangle, Burger
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex02.html" class="md-nav__link">
      2. Date, GCD, Leap, Multiple
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex03.html" class="md-nav__link">
      3. Three, Factor, Parity, Nine, HDB
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex04.html" class="md-nav__link">
      4. Binary, Onigiri, Fibonacci
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex05.html" class="md-nav__link">
      5. Counter, Dot, Unit
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex06.html" class="md-nav__link">
      6. Error, Twilight, Reverse, Unique, LookNSay
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex08.html" class="md-nav__link">
      8. Length, Concat, Search
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="ex09.html" class="md-nav__link">
      9. Echo, Subtract, Line
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    
    <label class="md-nav__link" for="nav-7">
      Assignments
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Assignments" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Assignments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="assignment.html" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="as01.html" class="md-nav__link">
      1. Pyramid, Digits, Suffix, Taxi
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="as02.html" class="md-nav__link">
      2. Collatz, Rectangle, Prime, Pattern
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="as03.html" class="md-nav__link">
      3. Days, ID, Max, Padovan
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="as04.html" class="md-nav__link">
      4. Selection, Mastermind
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="as05.html" class="md-nav__link">
      5. Kendall, CountingSort, Add
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="readings.html" class="md-nav__link">
      Readings
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="c-in-cs1010.html" class="md-nav__link">
      C in CS1010
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="style.html" class="md-nav__link">
      C Style Convention
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="documentation.html" class="md-nav__link">
      C Documentation
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="messages.html" class="md-nav__link">
      C Compiler Messages
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="library.html" class="md-nav__link">
      CS1010 I/O Library
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14" >
    
    <label class="md-nav__link" for="nav-14">
      Software/Tools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Software/Tools" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        <span class="md-nav__icon md-icon"></span>
        Software/Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="environments.html" class="md-nav__link">
      Programming Environments
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="github.html" class="md-nav__link">
      GitHub
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="unix.html" class="md-nav__link">
      UNIX
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="clang.html" class="md-nav__link">
      CLang
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="vim.html" class="md-nav__link">
      Vim
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="make.html" class="md-nav__link">
      Make
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="tmate.html" class="md-nav__link">
      TMate
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="zoom.html" class="md-nav__link">
      Zoom
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="panopto/panopto.html" class="md-nav__link">
      Panopto
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="1819s1.html" class="md-nav__link">
      18/19 Semester 1
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-on-heap" class="md-nav__link">
    Variables on Heap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-memory-allocation-deallocation" class="md-nav__link">
    Manual Memory Allocation / Deallocation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-deallocation" class="md-nav__link">
    Memory Deallocation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-reallocation" class="md-nav__link">
    Memory Reallocation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cs1010-io-library" class="md-nav__link">
    CS1010 I/O Library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-set" class="md-nav__link">
    Problem Set
  </a>
  
    <nav class="md-nav" aria-label="Problem Set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-set-171" class="md-nav__link">
    Problem Set 17.1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="unit-17-heap">Unit 17: Heap</h1>
<h2 id="learning-objectives">Learning Objectives</h2>
<p>After completing this unit, students should:</p>
<ul>
<li>understand the differences between the stack and the heap</li>
<li>be able to use <code>malloc</code> and <code>calloc</code> to declare dynamically-sized arrays on the heap</li>
<li>understand the importance of (i) checking for NULL and (ii) free the memory allocated on the heap</li>
<li>aware of the possibility of memory leakage and avoid common mistakes that could lead to memory leaks</li>
</ul>
<h2 id="variables-on-heap">Variables on Heap</h2>
<p>We have already seen what a call stack is and how the call stack works in <a href="13-call-stack.html">Unit 13</a>.  There is another important area of memory used by our programs, called the <em>heap</em>.</p>
<p>The memory allocation on the heap can be done automatically or manually.  For variables allocated on the heap, its lifetime is either the same as the lifetime of the <em>whole</em> program.  An example of such a variable is a <em>global</em> variable -- a variable that is declared <em>outside</em> of any function and can be read or write anywhere in the program.  We have banned the use of global variables in CS1010.  Using a global variable makes your code hard to understand or reason about:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">foo</span><span class="p">();</span>
<span class="c1">// { x == ?? }</span>
</code></pre></div>
</td></tr></table>
<p>Suppose <code>x</code> is a global variable, we cannot assert anything about the property of <code>x</code> after calling <code>foo</code>, since <code>x</code> can be modified by <code>foo</code> or any function it calls, even though we <em>never pass <code>x</code> into <code>foo</code></em>.  This is worse than passing an array as we have seen in <a href="16-call-by-reference.html">Unit 16</a>!  Since now, to assert something about <code>x</code>, we need to trace through every line the code to how <code>x</code> is updated, even if the function does not take in <code>x</code> as a parameter.</p>
<h2 id="manual-memory-allocation-deallocation">Manual Memory Allocation / Deallocation</h2>
<p>Allocating memory on the heap, however, is useful if we want to allocate an array dynamically, i.e., not knowing what is the size of the array when we write the program.  Often, we need an array whose size depends on the input from the user, such as reading a string or reading a sequence of numbers.  We cannot use a fixed-length array unless we know for sure that the input size is limited, and we cannot use a variable-length array, since we may get a segfault if the array size is too big for the stack.  The only viable solution is to allocate the array on the heap.</p>
<p>The C standard library provides a few functions related to memory allocation on the heap.  The header file for these functions is <code>stdlib.h</code>.  We are interested in <code>malloc</code> and <code>calloc</code>.  <code>malloc</code> (memory allocation) is declared as:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="o">*</span><span class="nf">malloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
</code></pre></div>
</td></tr></table></p>
<p>It takes in a parameter, <code>size</code>, which is the number of bytes of memory to be allocated and returns a pointer to the memory allocated if successful, or <code>NULL</code> otherwise.  This is a general function so the type of pointer returned is <code>void *</code> rather than a pointer to a specific type.  </p>
<p>The type of <code>size</code> is <code>size_t</code>, which is an unsigned integer type defined in <code>stdlib.h</code> to represent the size of a type/variable in memory. You can read a <code>size_t</code> variable from the standard input using the CS1010 library function <code>cs1010_read_size_t()</code>.</p>
<p>The function <code>calloc</code> (clear allocation) is declared as:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="o">*</span><span class="nf">calloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
</code></pre></div>
</td></tr></table></p>
<p><code>calloc</code> allocates memory for <code>count</code> items, each of <code>size</code> number of bytes, in a contiguous region in the memory and initializes all bits in this memory region to 0.  Except for the fact that <code>calloc</code> initializes the bits to 0, <code>calloc(count, size)</code> is the same as <code>malloc(count * size)</code>.</p>
<p>We have seen in <a href="05-first-c.html">Unit 5</a> that the number of bytes needed to represent a type depends on the platform.  Suppose we want to allocate enough memory for, say, 10 <code>long</code> values, how do we know how many bytes are needed?  A <code>long</code> can be 4 bytes on some platforms, 8 bytes on others.  For this purpose, C provides a <code>sizeof</code> operator, that returns the number of bytes needed for a type or a variable (of type <code>size_t</code>)  So, to allocate memory for 10 <code>long</code> values, we say:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">long</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">));</span>
</code></pre></div>
</td></tr></table></p>
<h2 id="memory-deallocation">Memory Deallocation</h2>
<p>Even though the memory available on the heap is larger than the stack, it is not unlimited, and therefore we should still use the memory judiciously.   In particular, after we are done using the memory allocated to us, we should call the method <code>free</code>, passing in the pointer the memory region allocated, to have the memory region deallocated, returned to the OS to be reused by others.</p>
<p>A common bug is for a programmer to access a memory that has been freed or free an allocated memory region more than once.  This would cause strange behaviors, possible crashes in random places if we access memory that is being used by others.  It is a good practice to set the pointer to NULL after <code>free</code>-ing the memory region so that we do not accidentally use it.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>free(buffer);
buffer = NULL;
</code></pre></div>
</td></tr></table>
<p>Another common bug is for programmers to request memory via <code>malloc</code> or related functions, but forgot to <code>free</code> it back to the OS.  As a result, as the program runs, it starts to hog the memory and the system will become slower and slower.   This bug is known as <em>memory leak</em>.</p>
<p>Another possible bug is for programmers to change the pointer to the region of memory allocated.  For instance,
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>long *buffer = calloc(how_many, sizeof(long));
buffer = cs1010_read_long_array(how_many);
</code></pre></div>
</td></tr></table></p>
<p>After we execute the code such as the above, the pointer <code>buffer</code> will point to something new, and there is no longer a pointer pointing to allocate memory.  The memory allocated becomes unreachable, and therefore we can no longer free it!</p>
<p>In CS1010, from now on, you are to make sure that memory that is allocated via <code>malloc</code> and related functions are <code>free</code> after it is used, including those allocated in the CS1010 I/O library.  The <a href="library.html">API documentation</a> tells you what are the values returned by the library that should be deallocated by the caller via <code>free</code>.</p>
<h2 id="memory-reallocation">Memory Reallocation</h2>
<p>If we allocate an array on the heap, we can even change the size of the array dynamically during run-time.  For instance, there could be cases where we don't know the size of the array we need.  We can allocate an array, say, of size <code>n</code>, at the beginning of our program.  As we populate the array, we may realize that <code>n</code> is too small, and we need a bigger array.  We can use the method <code>realloc</code> to reallocate our array to a larger size as needed.  Interested students can read the man page for <code>realloc</code> for more details. </p>
<h2 id="cs1010-io-library">CS1010 I/O Library</h2>
<p>To wrap up this unit, we will look at the CS1010 library functions that help us read in an array of either <code>long</code> values or <code>double</code> values.  These functions, <code>cs1010_read_long_array</code> or <code>cs1010_read_double_array</code> take in a parameter, which is the number of elements to read (of type <code>size_t</code>) and it returns a pointer to the array allocated within the function.</p>
<p>A typical usage is as follows: we first read the size of the array <code>size</code> with <code>cs1010_read_size_t()</code>, then use <code>cs1010_read_long_array(size)</code> to read the array.</p>
<p>Here is the incomplete version:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">size_t</span> <span class="n">num_of_students</span> <span class="o">=</span> <span class="n">cs1010_read_size_t</span><span class="p">();</span>
<span class="kt">long</span> <span class="o">*</span><span class="n">marks</span><span class="p">;</span>
<span class="n">marks</span> <span class="o">=</span> <span class="n">cs1010_read_long_array</span><span class="p">(</span><span class="n">num_of_students</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_of_students</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cs1010_println_long</span><span class="p">(</span><span class="n">marks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table></p>
<p>This should be straightforward enough.  There are, however, two cases to consider.  What if the OS failed to allocate the memory for our array?  In this case, marks would be <code>NULL</code> and access <code>marks[i]</code> would cause a segfault. Second, we must return the memory allocated to us back to the OS once we are done.  To let go of this memory, we call the function <code>free</code>.  The complete code looks like this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">size_t</span> <span class="n">num_of_students</span> <span class="o">=</span> <span class="n">cs1010_read_size_t</span><span class="p">();</span>
<span class="kt">long</span> <span class="o">*</span><span class="n">marks</span><span class="p">;</span>
<span class="n">marks</span> <span class="o">=</span> <span class="n">cs1010_read_long_array</span><span class="p">(</span><span class="n">num_of_students</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">marks</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// signal error and return</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_of_students</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cs1010_println_long</span><span class="p">(</span><span class="n">marks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// do other things to marks</span>
  <span class="o">:</span>

<span class="n">free</span><span class="p">(</span><span class="n">marks</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<p>The CS1010 I/O library, internally, allocates memory on the heap so that we can read in words, lines, or arrays of arbitrary length.</p>
<p>The following shows the example of how <code>cs1010_read_long_array</code> is implemented with <code>calloc</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="o">*</span> <span class="nf">cs1010_read_long_array</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">how_many</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">long</span> <span class="o">*</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">how_many</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">how_many</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cs1010_read_long</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">buffer</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h2 id="problem-set">Problem Set</h2>
<h3 id="problem-set-171">Problem Set 17.1</h3>
<p>Draw the call stack and the heap, showing what happened when we run the following code:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="kt">long</span> <span class="o">*</span><span class="n">z</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">-7</span><span class="p">;</span>
  <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">-8</span><span class="p">;</span>
  <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>  
  <span class="kt">long</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
  <span class="kt">long</span> <span class="o">*</span><span class="n">z</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">));</span>

  <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

  <span class="n">foo</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="16-call-by-reference.html" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                16. Call-by-Reference
              </div>
            </div>
          </a>
        
        
          <a href="18-string.html" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                18. String
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright by Department of Computer Science, National University of Singapore 2021
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.08c56446.min.js"></script>
      <script src="assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
      
    
  </body>
</html>